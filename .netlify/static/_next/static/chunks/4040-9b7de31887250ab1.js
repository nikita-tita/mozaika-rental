"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4040],{14186:(e,t,a)=>{a.d(t,{A:()=>l});let l=(0,a(72895).A)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},24040:(e,t,a)=>{a.d(t,{A:()=>u});var l=a(95155),s=a(12115),n=a(41665),i=a(32251),d=a(84616);let r=(0,a(72895).A)("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]);var c=a(17580),o=a(27414),m=a(69074),h=a(32919),x=a(14186);function u(e){let{isOpen:t,onClose:a,onSuccess:u}=e,[p,b]=(0,s.useState)([]),[j,v]=(0,s.useState)([]),[g,f]=(0,s.useState)(!1),[y,N]=(0,s.useState)([]),[k,S]=(0,s.useState)(""),[w,D]=(0,s.useState)(!1),[C,M]=(0,s.useState)({title:"",description:"",propertyId:"",tenantId:"",landlordId:"",monthlyRent:"",deposit:"",startDate:"",endDate:"",commission:"",duration:"11"});(0,s.useEffect)(()=>{t&&(A(),I())},[t]);let A=async()=>{try{let e=await fetch("/api/properties"),t=await e.json();t.success&&b(t.data)}catch(e){console.error("Error fetching properties:",e)}},I=async()=>{try{let e=await fetch("/api/clients"),t=await e.json();t.success&&v(t.data)}catch(e){console.error("Error fetching clients:",e)}},T=async e=>{e.preventDefault(),f(!0),N([]),S("");try{let e={...C,monthlyRent:parseFloat(C.monthlyRent)||0,deposit:C.deposit?parseFloat(C.deposit):void 0,commission:C.commission?parseFloat(C.commission):void 0};console.log("Sending deal data:",e);let t=await fetch("/api/deals",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),l=await t.json();console.log("Response from server:",l),l.success?(S(l.message||"Сделка успешно создана"),M({title:"",description:"",propertyId:"",tenantId:"",landlordId:"",monthlyRent:"",deposit:"",startDate:"",endDate:"",commission:"",duration:"11"}),D(!1),setTimeout(()=>{var e;S(""),a(),u(null==(e=l.data)?void 0:e.id)},2e3)):N([l.error||"Ошибка при создании сделки"])}catch(e){console.error("Error creating deal:",e),N(["Ошибка при создании сделки"])}finally{f(!1)}},H=e=>{let{name:t,value:a}=e.target;M(e=>({...e,[t]:a}))};return(0,l.jsx)(n.ih,{isOpen:t,onClose:a,title:"Создать новую сделку",children:(0,l.jsxs)("form",{onSubmit:T,className:"space-y-6",children:[y.length>0&&(0,l.jsx)(n.N6,{variant:"error",title:"Ошибка",children:(0,l.jsx)("ul",{className:"list-disc list-inside",children:y.map((e,t)=>(0,l.jsx)("li",{children:e},t))})}),k&&(0,l.jsx)(n.N6,{variant:"success",title:"Успешно",children:k}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("h3",{className:"text-lg font-medium text-[#323130] mb-4 flex items-center",children:[(0,l.jsx)(d.A,{className:"w-5 h-5 mr-2"}),"Основная информация"]}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("label",{className:"block text-sm font-medium text-[#323130] mb-1",children:["Название сделки ",(0,l.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,l.jsx)(n.V$,{name:"title",placeholder:"Например: Аренда квартиры на ул. Ленина",value:C.title,onChange:H,required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-[#323130] mb-1",children:"Описание"}),(0,l.jsx)(n.JH,{name:"description",placeholder:"Дополнительная информация о сделке",value:C.description,onChange:H,rows:3})]})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("h3",{className:"text-lg font-medium text-[#323130] mb-4 flex items-center",children:[(0,l.jsx)(r,{className:"w-5 h-5 mr-2"}),"Объект недвижимости"]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("label",{className:"block text-sm font-medium text-[#323130] mb-1",children:["Выберите объект ",(0,l.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,l.jsx)(n.H1,{value:C.propertyId,onChange:e=>{let t=p.find(t=>t.id===e);t&&M(e=>({...e,propertyId:t.id,monthlyRent:t.price.toString()}))},options:[{value:"",label:"Выберите объект недвижимости"},...p.map(e=>({value:e.id,label:"".concat(e.title," - ").concat(e.address," (").concat(e.price," ₽/мес)")}))]})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("h3",{className:"text-lg font-medium text-[#323130] mb-4 flex items-center",children:[(0,l.jsx)(c.A,{className:"w-5 h-5 mr-2"}),"Участники сделки"]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("label",{className:"block text-sm font-medium text-[#323130] mb-1",children:["Арендатор ",(0,l.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,l.jsx)(n.H1,{value:C.tenantId,onChange:e=>{let t=j.find(t=>t.id===e);t&&M(e=>({...e,tenantId:t.id}))},options:[{value:"",label:"Выберите арендатора"},...j.filter(e=>"TENANT"===e.type||"BOTH"===e.type).map(e=>({value:e.id,label:"".concat(e.firstName," ").concat(e.lastName," (").concat(e.phone,")")}))]})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("label",{className:"block text-sm font-medium text-[#323130] mb-1",children:["Арендодатель ",(0,l.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,l.jsx)(n.H1,{value:C.landlordId,onChange:e=>{let t=j.find(t=>t.id===e);t&&M(e=>({...e,landlordId:t.id}))},options:[{value:"",label:"Выберите арендодателя"},...j.filter(e=>"LANDLORD"===e.type||"BOTH"===e.type).map(e=>({value:e.id,label:"".concat(e.firstName," ").concat(e.lastName," (").concat(e.phone,")")}))]})]})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("h3",{className:"text-lg font-medium text-[#323130] mb-4 flex items-center",children:[(0,l.jsx)(o.A,{className:"w-5 h-5 mr-2"}),"Финансовые условия"]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("label",{className:"block text-sm font-medium text-[#323130] mb-1",children:["Сумма аренды (₽/мес) ",(0,l.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,l.jsx)(n.V$,{name:"monthlyRent",type:"number",placeholder:"0",value:C.monthlyRent,onChange:H,required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-[#323130] mb-1",children:"Залог (₽)"}),(0,l.jsx)(n.V$,{name:"deposit",type:"number",placeholder:"0",value:C.deposit,onChange:H})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-[#323130] mb-1",children:"Комиссия (₽)"}),(0,l.jsx)(n.V$,{name:"commission",type:"number",placeholder:"0",value:C.commission,onChange:H})]})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("h3",{className:"text-lg font-medium text-[#323130] mb-4 flex items-center",children:[(0,l.jsx)(m.A,{className:"w-5 h-5 mr-2"}),"Даты аренды"]}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-[#323130] mb-1",children:"Срок аренды"}),(0,l.jsx)(n.H1,{value:C.duration,onChange:e=>{let t="custom"===e;if(D(t),M(t=>({...t,duration:e})),t)return void M(t=>({...t,duration:e,endDate:""}));if(C.startDate&&e){let t=new Date(new Date(C.startDate));t.setMonth(t.getMonth()+parseInt(e)),M(a=>({...a,duration:e,endDate:t.toISOString().split("T")[0]}))}},options:[{value:"1",label:"1 месяц"},{value:"3",label:"3 месяца"},{value:"6",label:"6 месяцев"},{value:"11",label:"11 месяцев (стандарт)"},{value:"12",label:"12 месяцев"},{value:"24",label:"24 месяца"},{value:"36",label:"36 месяцев"},{value:"custom",label:"Произвольный срок"}]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("label",{className:"block text-sm font-medium text-[#323130] mb-1",children:["Дата начала ",(0,l.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,l.jsx)(i.l,{value:C.startDate,onChange:e=>{if(M(t=>({...t,startDate:e})),e&&C.duration&&!w){let t=new Date(new Date(e));t.setMonth(t.getMonth()+parseInt(C.duration)),M(a=>({...a,startDate:e,endDate:t.toISOString().split("T")[0]}))}}})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("label",{className:"block text-sm font-medium text-[#323130] mb-1 flex items-center",children:["Дата окончания",!w&&C.startDate&&(0,l.jsx)("span",{title:"Рассчитывается автоматически",children:(0,l.jsx)(h.A,{className:"w-4 h-4 ml-2 text-gray-400"})})]}),(0,l.jsx)(i.l,{value:C.endDate,onChange:e=>{M(t=>({...t,endDate:e}))},disabled:!w}),!w&&(0,l.jsxs)("p",{className:"text-xs text-gray-500 mt-1 flex items-center",children:[(0,l.jsx)(h.A,{className:"w-3 h-3 mr-1"}),"Рассчитывается автоматически на основе срока аренды"]}),w&&(0,l.jsx)("p",{className:"text-xs text-blue-600 mt-1",children:"Укажите произвольную дату окончания"})]})]}),C.startDate&&C.endDate&&(0,l.jsx)("div",{className:"bg-blue-50 p-3 rounded-lg",children:(0,l.jsxs)("div",{className:"flex items-center text-sm text-blue-700",children:[(0,l.jsx)(x.A,{className:"w-4 h-4 mr-2"}),(0,l.jsxs)("span",{children:["Срок аренды: ",C.startDate," - ",C.endDate,!w&&C.duration&&(0,l.jsxs)("span",{className:"ml-2 text-blue-600",children:["(",C.duration," ",1===parseInt(C.duration)?"месяц":5>parseInt(C.duration)?"месяца":"месяцев",")"]})]})]})})]})]}),(0,l.jsxs)("div",{className:"flex justify-end space-x-3 pt-6 border-t border-gray-200",children:[(0,l.jsx)(n.Pd,{type:"button",variant:"outline",onClick:a,disabled:g,children:"Отмена"}),(0,l.jsx)(n.Pd,{type:"submit",disabled:g,children:g?"Создание...":"Создать сделку"})]})]})})}},27414:(e,t,a)=>{a.d(t,{A:()=>l});let l=(0,a(72895).A)("Banknote",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]])},32251:(e,t,a)=>{a.d(t,{l:()=>i});var l=a(95155),s=a(12115),n=a(41665);function i(e){let{value:t,onChange:a,placeholder:i="Дата рождения",className:d="",disabled:r=!1}=e,[c,o]=(0,s.useState)(""),[m,h]=(0,s.useState)(""),[x,u]=(0,s.useState)(""),[p,b]=(0,s.useState)(""),[j,v]=(0,s.useState)(!1),g=Array.from({length:31},(e,t)=>t+1),f=new Date().getFullYear(),y=Array.from({length:f-1950+1},(e,t)=>f-t),N=[];for(let e=1950;e<=f;e+=10){let t=Math.min(e+9,f);N.push({label:"".concat(e,"-").concat(t),years:Array.from({length:t-e+1},(t,a)=>e+a)})}return(0,s.useEffect)(()=>{if(t){let e=new Date(t);isNaN(e.getTime())||(o(e.getDate().toString().padStart(2,"0")),h((e.getMonth()+1).toString().padStart(2,"0")),u(e.getFullYear().toString()),b(t))}},[t]),(0,s.useEffect)(()=>{if(!j&&c&&m&&x){let e="".concat(x,"-").concat(m,"-").concat(c.padStart(2,"0"));a(e),b(e)}else j||c||m||x||(a(""),b(""))},[c,m,x,a,j]),(0,l.jsxs)("div",{className:"space-y-3 ".concat(d),children:[!r&&(0,l.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,l.jsxs)("label",{className:"flex items-center",children:[(0,l.jsx)("input",{type:"radio",checked:!j,onChange:()=>v(!1),className:"mr-2",disabled:r}),(0,l.jsx)("span",{className:"text-sm text-[#323130]",children:"Выбор из списка"})]}),(0,l.jsxs)("label",{className:"flex items-center",children:[(0,l.jsx)("input",{type:"radio",checked:j,onChange:()=>v(!0),className:"mr-2",disabled:r}),(0,l.jsx)("span",{className:"text-sm text-[#323130]",children:"Ручной ввод"})]})]}),j?(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-[#323130] mb-1",children:"Дата (ГГГГ-ММ-ДД)"}),(0,l.jsx)(n.V$,{value:p,onChange:e=>(e=>{if(b(e),e.match(/^\d{4}-\d{2}-\d{2}$/)){let t=new Date(e);isNaN(t.getTime())||(o(t.getDate().toString().padStart(2,"0")),h((t.getMonth()+1).toString().padStart(2,"0")),u(t.getFullYear().toString()),a(e),v(!1))}})(e.target.value),onBlur:()=>{if(p&&p.match(/^\d{4}-\d{2}-\d{2}$/)){let e=new Date(p);isNaN(e.getTime())||(o(e.getDate().toString().padStart(2,"0")),h((e.getMonth()+1).toString().padStart(2,"0")),u(e.getFullYear().toString()),a(p),v(!1))}},placeholder:"2020-01-15",disabled:r})]}):(0,l.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-[#323130] mb-1",children:"День"}),(0,l.jsx)(n.H1,{value:c,onChange:e=>o(e),placeholder:"День",disabled:r,options:[{value:"",label:"День"},...g.map(e=>({value:e.toString(),label:e.toString()}))]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-[#323130] mb-1",children:"Месяц"}),(0,l.jsx)(n.H1,{value:m,onChange:e=>h(e),placeholder:"Месяц",disabled:r,options:[{value:"",label:"Месяц"},{value:"01",label:"Январь"},{value:"02",label:"Февраль"},{value:"03",label:"Март"},{value:"04",label:"Апрель"},{value:"05",label:"Май"},{value:"06",label:"Июнь"},{value:"07",label:"Июль"},{value:"08",label:"Август"},{value:"09",label:"Сентябрь"},{value:"10",label:"Октябрь"},{value:"11",label:"Ноябрь"},{value:"12",label:"Декабрь"}]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-[#323130] mb-1",children:"Год"}),(0,l.jsx)(n.H1,{value:x,onChange:e=>u(e),placeholder:"Год",disabled:r,options:[{value:"",label:"Год"},...N.map(e=>({value:"",label:"--- ".concat(e.label," ---"),disabled:!0})),...y.map(e=>({value:e.toString(),label:e.toString()}))]})]})]})]})}},32919:(e,t,a)=>{a.d(t,{A:()=>l});let l=(0,a(72895).A)("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]])},84616:(e,t,a)=>{a.d(t,{A:()=>l});let l=(0,a(72895).A)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])}}]);