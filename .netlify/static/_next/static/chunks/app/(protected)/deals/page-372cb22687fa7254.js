(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9540],{29573:(e,s,t)=>{Promise.resolve().then(t.bind(t,61782))},55670:(e,s,t)=>{"use strict";t.d(s,{A:()=>l});let l=(0,t(72895).A)("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]])},61782:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>j});var l=t(95155),a=t(12115),n=t(84616),r=t(28199),i=t(55670),c=t(69074),d=t(59434),o=t(41665),x=t(24040);let m=[{value:"ALL",label:"Все статусы"},{value:"DRAFT",label:"Черновик"},{value:"NEW",label:"Новая"},{value:"IN_PROGRESS",label:"В работе"},{value:"COMPLETED",label:"Завершена"},{value:"CANCELLED",label:"Отменена"}],u=[{value:"landlord",label:"Мои объекты в аренде"},{value:"tenant",label:"Мои арендованные объекты"}],h={DRAFT:{label:"Черновик",description:"Сделка создана, но не подтверждена",color:"default",actions:["edit","delete","activate"],nextStage:"NEW"},NEW:{label:"Новая",description:"Сделка подтверждена, ожидает начала работы",color:"info",actions:["view","edit","start","cancel"],nextStage:"IN_PROGRESS"},IN_PROGRESS:{label:"В работе",description:"Сделка активна, договор подписан",color:"warning",actions:["view","complete","cancel"],nextStage:"COMPLETED"},COMPLETED:{label:"Завершена",description:"Сделка успешно завершена",color:"success",actions:["view"],nextStage:null},CANCELLED:{label:"Отменена",description:"Сделка отменена",color:"error",actions:["view"],nextStage:null}};function j(){let[e,s]=(0,a.useState)([]),[t,i]=(0,a.useState)(!0),[c,d]=(0,a.useState)(!1),[j,p]=(0,a.useState)({status:"ALL",role:"landlord"}),[N,y]=(0,a.useState)("cards"),[f,b]=(0,a.useState)(null);(0,a.useEffect)(()=>{w()},[j]);let w=async()=>{i(!0);try{let e=new URLSearchParams;Object.entries(j).forEach(s=>{let[t,l]=s;l&&"ALL"!==l&&e.append(t,l)});let t=await fetch("/api/deals?".concat(e)),l=await t.json();l.success?s(l.data):console.error("Error fetching deals:",l.error)}catch(e){console.error("Error fetching deals:",e)}finally{i(!1)}},S=async(e,t)=>{b(e);try{let l=await fetch("/api/deals/".concat(e),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:t})}),a=await l.json();a.success?(s(s=>s.map(s=>s.id===e?{...s,status:t}:s)),alert(a.message||"Статус сделки обновлен")):alert(a.error||"Ошибка при обновлении статуса")}catch(e){console.error("Error updating deal:",e),alert("Ошибка при обновлении сделки")}finally{b(null)}},E=e=>{let s=h[e];return s?(0,l.jsx)(o.a,{variant:s.color,children:s.label}):(0,l.jsx)(o.a,{variant:"default",children:"Неизвестно"})},C=e=>{let s=h[e.status];return(null==s?void 0:s.nextStage)!==null},A=e=>{let s=h[e];return(null==s?void 0:s.nextStage)||null},R=e=>{let s=h[e];return(null==s?void 0:s.description)||"Описание недоступно"},L=e=>{let s=A(e);if(!s)return null;switch(s){case"NEW":return"Активировать";case"IN_PROGRESS":return"Начать работу";case"COMPLETED":return"Завершить";default:return"Следующий этап"}};return t?(0,l.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,l.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,l.jsx)(o.ts,{isLoading:!0}),(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsx)(o.wQ,{className:"h-8 w-64"}),(0,l.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(6)].map((e,s)=>(0,l.jsx)(o.wQ,{className:"h-48"},s))})]})]})}):(0,l.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,l.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,l.jsxs)("div",{className:"mb-8",children:[(0,l.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Управление сделками"}),(0,l.jsx)("p",{className:"text-lg text-gray-600",children:"Отслеживание и управление сделками по долгосрочной аренде недвижимости"})]}),(0,l.jsx)("div",{className:"mb-6 flex justify-end",children:(0,l.jsx)(o.Pd,{onClick:()=>d(!0),icon:(0,l.jsx)(n.A,{className:"w-4 h-4"}),children:"Создать сделку"})}),(0,l.jsxs)("div",{className:"mb-6 flex flex-col sm:flex-row gap-4",children:[(0,l.jsx)(o.H1,{value:j.status,onChange:e=>p(s=>({...s,status:e})),options:m,placeholder:"Выберите статус",className:"w-full sm:w-48"}),(0,l.jsx)(o.H1,{value:j.role,onChange:e=>p(s=>({...s,role:e})),options:u,placeholder:"Выберите роль",className:"w-full sm:w-64"}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)(o.Pd,{variant:"cards"===N?"primary":"outline",onClick:()=>y("cards"),size:"sm",children:"Карточки"}),(0,l.jsx)(o.Pd,{variant:"table"===N?"primary":"outline",onClick:()=>y("table"),size:"sm",children:"Таблица"})]})]}),0===e.length?(0,l.jsxs)(o.zk,{className:"p-8 text-center",children:[(0,l.jsx)(r.A,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,l.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Нет активных сделок"}),(0,l.jsx)("p",{className:"text-gray-600 mb-4",children:"landlord"===j.role?"У вас пока нет объектов в аренде. Создайте новую сделку, чтобы начать.":"У вас пока нет арендованных объектов."}),(0,l.jsx)(o.Pd,{onClick:()=>d(!0),icon:(0,l.jsx)(n.A,{className:"w-4 h-4"}),children:"Создать сделку"})]}):"cards"===N?(0,l.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:e.map(e=>(0,l.jsx)(g,{deal:e,userRole:j.role,onStatusChange:S,canUpdate:C(e),getStatusBadge:E,getNextStatus:A,getStatusDescription:R,getActionButtonText:L,statusUpdateLoading:f},e.id))}):(0,l.jsxs)(o.Ps,{children:[(0,l.jsxs)(o.I0,{children:[(0,l.jsx)(o.qB,{children:"Объект"}),(0,l.jsx)(o.qB,{children:"Арендатор"}),(0,l.jsx)(o.qB,{children:"Статус"}),(0,l.jsx)(o.qB,{children:"Дата начала"}),(0,l.jsx)(o.qB,{children:"Сумма"}),(0,l.jsx)(o.qB,{children:"Действия"})]}),(0,l.jsx)(o.rI,{children:e.map(e=>(0,l.jsx)(v,{deal:e,userRole:j.role,onStatusChange:S,canUpdate:C(e),getStatusBadge:E,getNextStatus:A,getActionButtonText:L,statusUpdateLoading:f},e.id))})]}),(0,l.jsx)(x.A,{isOpen:c,onClose:()=>d(!1),onSuccess:w})]})})}function g(e){var s,t,a,n,r,x;let{deal:m,userRole:u,onStatusChange:h,canUpdate:j,getStatusBadge:g,getNextStatus:v,getStatusDescription:p,getActionButtonText:N,statusUpdateLoading:y}=e,f=v(m.status),b=N(m.status),w=y===m.id;return(0,l.jsxs)(o.zk,{className:"p-6",children:[(0,l.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:m.title||(null==(s=m.property)?void 0:s.title)||"Объект недвижимости"}),(0,l.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:(null==(t=m.property)?void 0:t.address)||"Адрес не указан"})]}),g(m.status)]}),(0,l.jsxs)("div",{className:"space-y-3 mb-4",children:[(0,l.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,l.jsx)(i.A,{className:"w-4 h-4 mr-2"}),(0,l.jsx)("span",{children:"landlord"===u?"Арендатор: ".concat(null==(a=m.tenant)?void 0:a.firstName," ").concat(null==(n=m.tenant)?void 0:n.lastName):"Арендодатель: ".concat(null==(r=m.landlord)?void 0:r.firstName," ").concat(null==(x=m.landlord)?void 0:x.lastName)})]}),(0,l.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,l.jsx)(c.A,{className:"w-4 h-4 mr-2"}),(0,l.jsxs)("span",{children:["Начало: ",(0,d.Yq)(m.startDate)]})]}),(0,l.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,l.jsx)(c.A,{className:"w-4 h-4 mr-2"}),(0,l.jsxs)("span",{children:["Окончание: ",(0,d.Yq)(m.endDate)]})]}),(0,l.jsx)("div",{className:"flex items-center text-sm font-semibold text-gray-900",children:(0,l.jsxs)("span",{children:[(0,d.$g)(m.monthlyRent||m.totalAmount)," / месяц"]})}),(0,l.jsx)("div",{className:"text-xs text-gray-500 bg-gray-50 p-2 rounded",children:p(m.status)})]}),j&&f&&b&&(0,l.jsx)(o.Pd,{variant:"outline",onClick:()=>h(m.id,f),className:"w-full",disabled:w,children:w?"Обновление...":b})]})}function v(e){var s,t,a,n,r,i,c,x;let{deal:m,userRole:u,onStatusChange:h,canUpdate:j,getStatusBadge:g,getNextStatus:v,getActionButtonText:p,statusUpdateLoading:N}=e,y=v(m.status),f=p(m.status),b=N===m.id;return(0,l.jsxs)(o.Tl,{children:[(0,l.jsx)(o.RH,{children:(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"font-medium text-gray-900",children:m.title||(null==(s=m.property)?void 0:s.title)||"Объект недвижимости"}),(0,l.jsx)("div",{className:"text-sm text-gray-500",children:(null==(t=m.property)?void 0:t.address)||"Адрес не указан"})]})}),(0,l.jsxs)(o.RH,{children:[(0,l.jsx)("div",{className:"text-sm text-gray-900",children:"landlord"===u?"".concat(null==(a=m.tenant)?void 0:a.firstName," ").concat(null==(n=m.tenant)?void 0:n.lastName):"".concat(null==(r=m.landlord)?void 0:r.firstName," ").concat(null==(i=m.landlord)?void 0:i.lastName)}),(0,l.jsx)("div",{className:"text-sm text-gray-500",children:"landlord"===u?null==(c=m.tenant)?void 0:c.email:null==(x=m.landlord)?void 0:x.email})]}),(0,l.jsx)(o.RH,{children:g(m.status)}),(0,l.jsxs)(o.RH,{children:[(0,l.jsx)("div",{className:"text-sm text-gray-900",children:(0,d.Yq)(m.startDate)}),(0,l.jsx)("div",{className:"text-sm text-gray-500",children:(0,d.Yq)(m.endDate)})]}),(0,l.jsxs)(o.RH,{children:[(0,l.jsx)("div",{className:"text-sm font-medium text-gray-900",children:(0,d.$g)(m.monthlyRent||m.totalAmount)}),(0,l.jsx)("div",{className:"text-sm text-gray-500",children:"в месяц"})]}),(0,l.jsx)(o.RH,{children:j&&y&&f&&(0,l.jsx)(o.Pd,{variant:"outline",size:"sm",onClick:()=>h(m.id,y),disabled:b,children:b?"...":f})})]})}}},e=>{e.O(0,[7910,1665,4040,8441,5964,7358],()=>e(e.s=29573)),_N_E=e.O()}]);