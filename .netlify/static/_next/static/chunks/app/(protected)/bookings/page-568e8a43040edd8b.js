(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3861],{41755:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>u});var l=a(95155),t=a(12115),r=a(6874),n=a.n(r),c=a(28199),i=a(55670),d=a(69074),x=a(59434),o=a(41665);let m=[{value:"ALL",label:"Все статусы"},{value:"SEARCHING",label:"Поиск арендатора"},{value:"NEGOTIATING",label:"Переговоры"},{value:"DOCUMENTS",label:"Подготовка документов"},{value:"SIGNING",label:"Подписание договора"},{value:"ACTIVE",label:"Активная аренда"},{value:"COMPLETED",label:"Завершена"},{value:"CANCELLED",label:"Отменена"}],h=[{value:"landlord",label:"Мои объекты в аренде"},{value:"tenant",label:"Мои арендованные объекты"}];function u(){let[e,s]=(0,t.useState)([]),[a,r]=(0,t.useState)(!0),[i,d]=(0,t.useState)({status:"ALL",role:"landlord"}),[x,u]=(0,t.useState)("cards");(0,t.useEffect)(()=>{v()},[i]);let v=async()=>{r(!0);try{let e=new URLSearchParams;Object.entries(i).forEach(s=>{let[a,l]=s;l&&"ALL"!==l&&e.append(a,l)});let a=await fetch("/api/deals?".concat(e)),l=await a.json();l.success&&s(l.data)}catch(e){console.error("Error fetching deals:",e)}finally{r(!1)}},g=async(e,s)=>{try{let a=await fetch("/api/deals/".concat(e),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:s})}),l=await a.json();l.success?v():alert(l.error)}catch(e){console.error("Error updating deal:",e),alert("Ошибка при обновлении сделки")}},p=e=>{switch(e){case"SEARCHING":return(0,l.jsx)(o.a,{variant:"warning",children:"Поиск арендатора"});case"NEGOTIATING":return(0,l.jsx)(o.a,{variant:"info",children:"Переговоры"});case"DOCUMENTS":return(0,l.jsx)(o.a,{variant:"info",children:"Документы"});case"SIGNING":return(0,l.jsx)(o.a,{variant:"success",children:"Подписание"});case"ACTIVE":return(0,l.jsx)(o.a,{variant:"success",children:"Активна"});case"COMPLETED":return(0,l.jsx)(o.a,{variant:"default",children:"Завершена"});case"CANCELLED":return(0,l.jsx)(o.a,{variant:"error",children:"Отменена"});default:return(0,l.jsx)(o.a,{variant:"default",children:"Неизвестно"})}},y=(e,s)=>"landlord"===s&&"COMPLETED"!==e.status&&"CANCELLED"!==e.status,f=e=>({SEARCHING:"NEGOTIATING",NEGOTIATING:"DOCUMENTS",DOCUMENTS:"SIGNING",SIGNING:"ACTIVE",ACTIVE:"COMPLETED"})[e]||null;return a?(0,l.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,l.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,l.jsx)(o.ts,{}),(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsx)(o.wQ,{className:"h-8 w-64"}),(0,l.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(6)].map((e,s)=>(0,l.jsx)(o.wQ,{className:"h-48"},s))})]})]})}):(0,l.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,l.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,l.jsxs)("div",{className:"mb-8",children:[(0,l.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Управление сделками"}),(0,l.jsx)("p",{className:"text-lg text-gray-600",children:"Отслеживание и управление сделками по долгосрочной аренде недвижимости"})]}),(0,l.jsxs)("div",{className:"mb-6 flex flex-col sm:flex-row gap-4",children:[(0,l.jsx)(o.H1,{value:i.status,onChange:e=>d(s=>({...s,status:e})),options:m,placeholder:"Выберите статус",className:"w-full sm:w-48"}),(0,l.jsx)(o.H1,{value:i.role,onChange:e=>d(s=>({...s,role:e})),options:h,placeholder:"Выберите роль",className:"w-full sm:w-64"}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)(o.Pd,{variant:"cards"===x?"primary":"outline",onClick:()=>u("cards"),size:"sm",children:"Карточки"}),(0,l.jsx)(o.Pd,{variant:"table"===x?"primary":"outline",onClick:()=>u("table"),size:"sm",children:"Таблица"})]})]}),0===e.length?(0,l.jsxs)(o.zk,{className:"p-8 text-center",children:[(0,l.jsx)(c.A,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,l.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Нет активных сделок"}),(0,l.jsx)("p",{className:"text-gray-600 mb-4",children:"landlord"===i.role?"У вас пока нет объектов в аренде. Добавьте объект недвижимости, чтобы начать.":"У вас пока нет арендованных объектов."}),"landlord"===i.role&&(0,l.jsx)(n(),{href:"/properties",children:(0,l.jsx)(o.Pd,{children:"Добавить объект"})})]}):"cards"===x?(0,l.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:e.map(e=>(0,l.jsx)(j,{deal:e,userRole:i.role,onStatusChange:g,canUpdate:y(e,i.role),getStatusBadge:p,getNextStatus:f},e.id))}):(0,l.jsxs)(o.Ps,{children:[(0,l.jsxs)(o.I0,{children:[(0,l.jsx)(o.qB,{children:"Объект"}),(0,l.jsx)(o.qB,{children:"Арендатор"}),(0,l.jsx)(o.qB,{children:"Статус"}),(0,l.jsx)(o.qB,{children:"Дата начала"}),(0,l.jsx)(o.qB,{children:"Сумма"}),(0,l.jsx)(o.qB,{children:"Действия"})]}),(0,l.jsx)(o.rI,{children:e.map(e=>(0,l.jsx)(N,{deal:e,userRole:i.role,onStatusChange:g,canUpdate:y(e,i.role),getStatusBadge:p,getNextStatus:f},e.id))})]})]})})}function j(e){var s,a,t,r,n,c;let{deal:m,userRole:h,onStatusChange:u,canUpdate:j,getStatusBadge:N,getNextStatus:v}=e,g=v(m.status);return(0,l.jsxs)(o.zk,{className:"p-6",children:[(0,l.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:(null==(s=m.property)?void 0:s.title)||"Объект недвижимости"}),(0,l.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:(null==(a=m.property)?void 0:a.address)||"Адрес не указан"})]}),N(m.status)]}),(0,l.jsxs)("div",{className:"space-y-3 mb-4",children:[(0,l.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,l.jsx)(i.A,{className:"w-4 h-4 mr-2"}),(0,l.jsx)("span",{children:"landlord"===h?"Арендатор: ".concat(null==(t=m.tenant)?void 0:t.firstName," ").concat(null==(r=m.tenant)?void 0:r.lastName):"Арендодатель: ".concat(null==(n=m.landlord)?void 0:n.firstName," ").concat(null==(c=m.landlord)?void 0:c.lastName)})]}),(0,l.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,l.jsx)(d.A,{className:"w-4 h-4 mr-2"}),(0,l.jsxs)("span",{children:["Начало: ",(0,x.Yq)(m.startDate)]})]}),(0,l.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,l.jsx)(d.A,{className:"w-4 h-4 mr-2"}),(0,l.jsxs)("span",{children:["Окончание: ",(0,x.Yq)(m.endDate)]})]}),(0,l.jsx)("div",{className:"flex items-center text-sm font-semibold text-gray-900",children:(0,l.jsxs)("span",{children:[(0,x.$g)(m.totalAmount)," / месяц"]})})]}),j&&g&&(0,l.jsx)(o.Pd,{variant:"outline",onClick:()=>u(m.id,g),className:"w-full",children:"Следующий этап"})]})}function N(e){var s,a,t,r,n,c,i,d;let{deal:m,userRole:h,onStatusChange:u,canUpdate:j,getStatusBadge:N,getNextStatus:v}=e,g=v(m.status);return(0,l.jsxs)(o.Tl,{children:[(0,l.jsx)(o.RH,{children:(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"font-medium text-gray-900",children:(null==(s=m.property)?void 0:s.title)||"Объект недвижимости"}),(0,l.jsx)("div",{className:"text-sm text-gray-500",children:(null==(a=m.property)?void 0:a.address)||"Адрес не указан"})]})}),(0,l.jsxs)(o.RH,{children:[(0,l.jsx)("div",{className:"text-sm text-gray-900",children:"landlord"===h?"".concat(null==(t=m.tenant)?void 0:t.firstName," ").concat(null==(r=m.tenant)?void 0:r.lastName):"".concat(null==(n=m.landlord)?void 0:n.firstName," ").concat(null==(c=m.landlord)?void 0:c.lastName)}),(0,l.jsx)("div",{className:"text-sm text-gray-500",children:"landlord"===h?null==(i=m.tenant)?void 0:i.email:null==(d=m.landlord)?void 0:d.email})]}),(0,l.jsx)(o.RH,{children:N(m.status)}),(0,l.jsxs)(o.RH,{children:[(0,l.jsx)("div",{className:"text-sm text-gray-900",children:(0,x.Yq)(m.startDate)}),(0,l.jsx)("div",{className:"text-sm text-gray-500",children:(0,x.Yq)(m.endDate)})]}),(0,l.jsxs)(o.RH,{children:[(0,l.jsx)("div",{className:"text-sm font-medium text-gray-900",children:(0,x.$g)(m.totalAmount)}),(0,l.jsx)("div",{className:"text-sm text-gray-500",children:"в месяц"})]}),(0,l.jsx)(o.RH,{children:j&&g&&(0,l.jsx)(o.Pd,{variant:"outline",size:"sm",onClick:()=>u(m.id,g),children:"Следующий этап"})})]})}},55292:(e,s,a)=>{Promise.resolve().then(a.bind(a,41755))},55670:(e,s,a)=>{"use strict";a.d(s,{A:()=>l});let l=(0,a(72895).A)("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]])}},e=>{e.O(0,[7910,1665,8441,5964,7358],()=>e(e.s=55292)),_N_E=e.O()}]);