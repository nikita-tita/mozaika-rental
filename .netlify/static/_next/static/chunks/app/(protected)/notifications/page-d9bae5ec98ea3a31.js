(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2463],{31521:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>y});var t=s(95155),r=s(12115),n=s(6874),c=s.n(n),i=s(41665),l=s(69074),d=s(81586),x=s(57434),m=s(28199),o=s(81497),h=s(23861),p=s(72895);let g=(0,p.A)("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]),j=(0,p.A)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);var u=s(59434);function y(){let[e,a]=(0,r.useState)([]),[s,n]=(0,r.useState)(!0),[p,j]=(0,r.useState)(!1),[u,y]=(0,r.useState)(1),[N,b]=(0,r.useState)(!1);(0,r.useEffect)(()=>{v()},[p,u]);let v=async()=>{n(!0);try{let e=new URLSearchParams;e.append("page",u.toString()),e.append("limit","20"),p&&e.append("unreadOnly","true");let s=await fetch("/api/notifications?".concat(e)),t=await s.json();t.success&&(1===u?a(t.data):a(e=>[...e,...t.data]),b(t.meta.hasMore))}catch(e){console.error("Error fetching notifications:",e)}finally{n(!1)}},w=async e=>{try{(await fetch("/api/notifications/mark-read",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({notificationId:e})})).ok&&a(a=>a.map(a=>a.id===e?{...a,read:!0,readAt:new Date().toISOString()}:a))}catch(e){console.error("Error marking notification as read:",e)}},k=async()=>{try{(await fetch("/api/notifications/mark-read",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({markAll:!0})})).ok&&a(e=>e.map(e=>({...e,read:!0,readAt:new Date().toISOString()})))}catch(e){console.error("Error marking all notifications as read:",e)}},A=e=>{switch(e){case"booking_created":case"booking_confirmed":case"booking_cancelled":return(0,t.jsx)(l.A,{className:"h-5 w-5 text-blue-500"});case"payment_required":case"payment_completed":case"payment_failed":return(0,t.jsx)(d.A,{className:"h-5 w-5 text-green-500"});case"contract_signed":return(0,t.jsx)(x.A,{className:"h-5 w-5 text-purple-500"});case"property_approved":case"property_rejected":return(0,t.jsx)(m.A,{className:"h-5 w-5 text-orange-500"});case"review_received":return(0,t.jsx)(o.A,{className:"h-5 w-5 text-pink-500"});case"message_received":return(0,t.jsx)(o.A,{className:"h-5 w-5 text-indigo-500"});default:return(0,t.jsx)(h.A,{className:"h-5 w-5 text-gray-500"})}},_=e=>{switch(e){case"urgent":return"border-l-red-500";case"high":return"border-l-orange-500";case"normal":return"border-l-blue-500";case"low":return"border-l-gray-500";default:return"border-l-gray-300"}},S=e=>e.bookingId?"/bookings":e.contractId?"/contracts/".concat(e.contractId):e.paymentId?"/payments":e.propertyId?"/properties/".concat(e.propertyId):null,C=e.filter(e=>!e.read).length;return(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,t.jsx)("div",{className:"bg-white border-b border-gray-200 py-4",children:(0,t.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,t.jsx)("nav",{className:"flex","aria-label":"Breadcrumb",children:(0,t.jsxs)("ol",{className:"flex items-center space-x-4",children:[(0,t.jsx)("li",{children:(0,t.jsx)("div",{className:"flex items-center",children:(0,t.jsx)("a",{href:"/dashboard",className:"text-gray-400 hover:text-gray-500",children:"Главная"})})}),(0,t.jsx)("li",{children:(0,t.jsx)("div",{className:"flex items-center",children:(0,t.jsx)("span",{className:"text-gray-500",children:"Уведомления"})})})]})})})}),(0,t.jsx)("header",{className:"bg-white shadow-sm",children:(0,t.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,t.jsx)("div",{className:"flex justify-between items-center h-16",children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(c(),{href:"/",className:"text-2xl font-bold text-primary-600 mr-8",children:"M\xb2"}),(0,t.jsxs)("nav",{className:"hidden md:flex md:space-x-8",children:[(0,t.jsx)(c(),{href:"/dashboard",className:"text-gray-500 hover:text-gray-700",children:"Панель управления"}),(0,t.jsxs)(c(),{href:"/notifications",className:"text-primary-600 font-medium",children:["Уведомления",C>0&&(0,t.jsx)("span",{className:"ml-2 inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:C})]})]})]})})})}),(0,t.jsxs)("main",{className:"max-w-4xl mx-auto py-6 px-4 sm:px-6 lg:px-8",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Уведомления"}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("input",{type:"checkbox",id:"unread-only",checked:p,onChange:e=>{j(e.target.checked),y(1)},className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),(0,t.jsx)("label",{htmlFor:"unread-only",className:"text-sm text-gray-700",children:"Только непрочитанные"})]})]}),C>0&&(0,t.jsxs)(i.Pd,{variant:"outline",onClick:k,children:[(0,t.jsx)(g,{className:"h-4 w-4 mr-2"}),"Отметить все как прочитанные"]})]}),s&&1===u?(0,t.jsx)("div",{className:"space-y-4",children:[void 0,void 0,void 0,void 0,void 0].map((e,a)=>(0,t.jsx)("div",{className:"bg-white rounded-lg shadow animate-pulse",children:(0,t.jsxs)("div",{className:"p-4 space-y-3",children:[(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),(0,t.jsx)("div",{className:"h-3 bg-gray-200 rounded w-1/2"}),(0,t.jsx)("div",{className:"h-3 bg-gray-200 rounded w-2/3"})]})},a))}):0===e.length?(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)(h.A,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,t.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:p?"Нет непрочитанных уведомлений":"Нет уведомлений"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:p?"Все уведомления прочитаны":"Уведомления будут появляться здесь"})]}):(0,t.jsxs)("div",{className:"space-y-4",children:[e.map(e=>(0,t.jsx)(f,{notification:e,onMarkAsRead:w,getIcon:A,getPriorityColor:_,getRelatedLink:S},e.id)),N&&(0,t.jsx)("div",{className:"text-center pt-6",children:(0,t.jsx)(i.Pd,{variant:"outline",onClick:()=>y(e=>e+1),loading:s,children:"Загрузить еще"})})]})]})]})}function f(e){let{notification:a,onMarkAsRead:s,getIcon:r,getPriorityColor:n,getRelatedLink:l}=e,d=l(a);return(0,t.jsx)("div",{className:"bg-white rounded-lg shadow border-l-4 ".concat(n(a.priority)," ").concat(a.read?"":"bg-blue-50"),children:(0,t.jsx)("div",{className:"p-4",children:(0,t.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,t.jsx)("div",{className:"flex-shrink-0 mt-1",children:r(a.type)}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("h3",{className:"text-sm font-medium ".concat(a.read?"text-gray-700":"text-gray-900"),children:a.title}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:["urgent"===a.priority&&(0,t.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:"Срочно"}),!a.read&&(0,t.jsx)(i.Pd,{size:"sm",variant:"ghost",onClick:()=>s(a.id),children:(0,t.jsx)(j,{className:"h-4 w-4"})})]})]}),(0,t.jsx)("p",{className:"text-sm mb-3 ".concat(a.read?"text-gray-600":"text-gray-900"),children:a.message}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:[(0,t.jsx)("span",{children:(0,u.Yq)(new Date(a.createdAt))}),a.channels.length>0&&(0,t.jsxs)("span",{children:["Отправлено: ",a.channels.join(", ")]})]}),d&&(0,t.jsx)(c(),{href:d,children:(0,t.jsx)(i.Pd,{size:"sm",variant:"outline",children:"Перейти"})})]})]})]})})})}},56400:(e,a,s)=>{Promise.resolve().then(s.bind(s,31521))},81497:(e,a,s)=>{"use strict";s.d(a,{A:()=>t});let t=(0,s(72895).A)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]])}},e=>{e.O(0,[7910,1665,8441,5964,7358],()=>e(e.s=56400)),_N_E=e.O()}]);