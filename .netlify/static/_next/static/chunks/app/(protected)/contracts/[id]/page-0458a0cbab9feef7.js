(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3758],{4621:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(72895).A)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]])},22915:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(72895).A)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},27414:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(72895).A)("Banknote",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]])},62153:(e,s,t)=>{Promise.resolve().then(t.bind(t,64816))},64816:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>g});var a=t(95155),r=t(12115),n=t(35695),l=t(6874),c=t.n(l),i=t(41665),d=t(35169),m=t(91788),x=t(4621),o=t(22915),h=t(57434),p=t(4516),j=t(71007),u=t(69074),y=t(27414),N=t(59434);function g(){var e,s,t,l;let g=(0,n.useParams)(),f=(0,n.useRouter)(),v=g.id,[w,b]=(0,r.useState)(null),[A,C]=(0,r.useState)(!0),[D,E]=(0,r.useState)(!1),[k,S]=(0,r.useState)({content:"",monthlyRent:"",deposit:""});(0,r.useEffect)(()=>{v&&P()},[v]);let P=async()=>{try{let t=await fetch("/api/contracts/".concat(v)),a=await t.json();if(a.success){var e,s;b(a.data),S({content:a.data.content||"",monthlyRent:(null==(e=a.data.monthlyRent)?void 0:e.toString())||"",deposit:(null==(s=a.data.deposit)?void 0:s.toString())||""})}else alert("Договор не найден"),f.push("/contracts")}catch(e){console.error("Error fetching contract:",e),alert("Ошибка при загрузке договора"),f.push("/contracts")}finally{C(!1)}},R=async e=>{let s={SIGNED:"Вы уверены, что хотите подписать договор? Это действие нельзя отменить.",CANCELLED:"Вы уверены, что хотите расторгнуть договор?"}[e];if(!s||confirm(s))try{let s=await fetch("/api/contracts/".concat(v),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:e})}),t=await s.json();t.success?(b(t.data),"SIGNED"===e&&alert("Договор успешно подписан!")):alert(t.error)}catch(e){console.error("Error updating contract:",e),alert("Ошибка при обновлении договора")}},L=async()=>{try{let e=await fetch("/api/contracts/".concat(v),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:k.content,monthlyRent:k.monthlyRent,deposit:k.deposit})}),s=await e.json();s.success?(b(s.data),E(!1),alert("Договор обновлен")):alert(s.error)}catch(e){console.error("Error updating contract:",e),alert("Ошибка при обновлении договора")}};if(A)return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})});if(!w)return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Договор не найден"}),(0,a.jsx)(c(),{href:"/contracts",children:(0,a.jsxs)(i.Pd,{children:[(0,a.jsx)(d.A,{className:"h-4 w-4 mr-2"}),"Вернуться к договорам"]})})]})});let T=w.property.ownerId===w.tenant.id,q="DRAFT"===w.status&&T,I="DRAFT"===w.status,M="SIGNED"===w.status;return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("header",{className:"bg-white shadow-sm print:hidden",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex items-center justify-between h-16",children:[(0,a.jsxs)(c(),{href:"/contracts",className:"flex items-center text-gray-600 hover:text-gray-900",children:[(0,a.jsx)(d.A,{className:"h-4 w-4 mr-2"}),"Назад к договорам"]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsxs)(i.Pd,{variant:"outline",onClick:()=>{window.print()},children:[(0,a.jsx)(m.A,{className:"h-4 w-4 mr-2"}),"Скачать PDF"]}),q&&!D&&(0,a.jsxs)(i.Pd,{variant:"outline",onClick:()=>E(!0),children:[(0,a.jsx)(x.A,{className:"h-4 w-4 mr-2"}),"Редактировать"]}),I&&(0,a.jsxs)(i.Pd,{onClick:()=>R("SIGNED"),children:[(0,a.jsx)(o.A,{className:"h-4 w-4 mr-2"}),"Подписать договор"]}),M&&(0,a.jsx)(i.Pd,{variant:"outline",onClick:()=>R("CANCELLED"),children:"Расторгнуть договор"})]})]})})}),(0,a.jsxs)("main",{className:"max-w-4xl mx-auto py-6 px-4 sm:px-6 lg:px-8",children:[(0,a.jsx)("div",{className:"bg-white rounded-lg shadow mb-6 print:shadow-none",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(h.A,{className:"h-8 w-8 text-primary-600"}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h1",{className:"text-2xl font-bold text-gray-900",children:["Договор аренды №",w.id.slice(-8)]}),(0,a.jsxs)("p",{className:"text-gray-600",children:["Создан: ",(0,N.Yq)(new Date(w.createdAt))]})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("div",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ".concat("DRAFT"===w.status?"bg-yellow-100 text-yellow-800":"SIGNED"===w.status?"bg-green-100 text-green-800":"COMPLETED"===w.status?"bg-blue-100 text-blue-800":"CANCELLED"===w.status?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:["DRAFT"===w.status&&"Черновик","SIGNED"===w.status&&"Подписан","COMPLETED"===w.status&&"Завершен","CANCELLED"===w.status&&"Отменен"]}),w.signedAt&&(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:["Подписан: ",(0,N.Yq)(new Date(w.signedAt))]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 border-t border-gray-200 pt-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center mb-2",children:[(0,a.jsx)(p.A,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,a.jsx)("h3",{className:"font-medium text-gray-900",children:"Недвижимость"})]}),(0,a.jsx)("p",{className:"text-sm font-medium",children:w.property.title}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:[w.property.address,", ",w.property.city]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:[w.property.area," м\xb2",w.property.rooms&&", ".concat(w.property.rooms," комн.")]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center mb-2",children:[(0,a.jsx)(j.A,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,a.jsx)("h3",{className:"font-medium text-gray-900",children:"Арендодатель"})]}),(0,a.jsxs)("p",{className:"text-sm font-medium",children:[null==(e=w.property.owner)?void 0:e.firstName," ",null==(s=w.property.owner)?void 0:s.lastName]}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:null==(t=w.property.owner)?void 0:t.email}),(null==(l=w.property.owner)?void 0:l.phone)&&(0,a.jsx)("p",{className:"text-sm text-gray-600",children:w.property.owner.phone})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center mb-2",children:[(0,a.jsx)(j.A,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,a.jsx)("h3",{className:"font-medium text-gray-900",children:"Арендатор"})]}),(0,a.jsxs)("p",{className:"text-sm font-medium",children:[w.tenant.firstName," ",w.tenant.lastName]}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:w.tenant.email}),w.tenant.phone&&(0,a.jsx)("p",{className:"text-sm text-gray-600",children:w.tenant.phone})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 border-t border-gray-200 pt-6 mt-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center mb-2",children:[(0,a.jsx)(u.A,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,a.jsx)("h3",{className:"font-medium text-gray-900",children:"Период аренды"})]}),(0,a.jsxs)("p",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:"С:"})," ",(0,N.Yq)(new Date(w.startDate))]}),(0,a.jsxs)("p",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:"По:"})," ",(0,N.Yq)(new Date(w.endDate))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center mb-2",children:[(0,a.jsx)(y.A,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,a.jsx)("h3",{className:"font-medium text-gray-900",children:"Арендная плата"})]}),D?(0,a.jsx)(i.V$,{type:"number",value:k.monthlyRent,onChange:e=>S(s=>({...s,monthlyRent:e.target.value})),className:"mb-2"}):(0,a.jsxs)("p",{className:"text-lg font-bold text-primary-600",children:[(0,N.$g)(Number(w.monthlyRent))," / мес"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center mb-2",children:[(0,a.jsx)(y.A,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,a.jsx)("h3",{className:"font-medium text-gray-900",children:"Залог"})]}),D?(0,a.jsx)(i.V$,{type:"number",value:k.deposit,onChange:e=>S(s=>({...s,deposit:e.target.value}))}):(0,a.jsx)("p",{className:"text-lg font-medium",children:(0,N.$g)(Number(w.deposit))})]})]})]})}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow print:shadow-none",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Условия договора"}),D&&(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)(i.Pd,{variant:"outline",onClick:()=>E(!1),children:"Отмена"}),(0,a.jsx)(i.Pd,{onClick:L,children:"Сохранить"})]})]}),D?(0,a.jsx)("textarea",{value:k.content,onChange:e=>S(s=>({...s,content:e.target.value})),rows:20,className:"w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-primary-500 focus:ring-1 focus:ring-primary-500 focus:outline-none font-mono"}):(0,a.jsx)("div",{className:"prose max-w-none",children:(0,a.jsx)("pre",{className:"whitespace-pre-wrap font-sans text-sm leading-relaxed text-gray-900",children:w.content})})]})}),"SIGNED"===w.status&&w.signedAt&&(0,a.jsx)("div",{className:"bg-green-50 rounded-lg p-6 mt-6 print:shadow-none",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(o.A,{className:"h-6 w-6 text-green-500 mr-3"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-medium text-green-900",children:"Договор подписан"}),(0,a.jsxs)("p",{className:"text-sm text-green-700",children:["Дата подписания: ",(0,N.Yq)(new Date(w.signedAt))]})]})]})})]})]})}},91788:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(72895).A)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])}},e=>{e.O(0,[7910,1665,8441,5964,7358],()=>e(e.s=62153)),_N_E=e.O()}]);