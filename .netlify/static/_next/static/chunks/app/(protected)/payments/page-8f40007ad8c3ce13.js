(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7078],{12486:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(72895).A)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]])},14186:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(72895).A)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},16525:(e,s,a)=>{Promise.resolve().then(a.bind(a,19152))},18533:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(72895).A)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},19152:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>A});var t=a(95155),l=a(12115),n=a(41665),r=a(81586),c=a(53904),i=a(84616),d=a(57434),x=a(23861),m=a(33109),o=a(22915),h=a(14186),u=a(18533),j=a(38164),p=a(12486);let y=(0,a(72895).A)("QrCode",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]);function N(e){let{paymentId:s,amount:a,dueDate:c,tenantEmail:i,tenantPhone:d,propertyTitle:m,onReminderSent:N}=e,[v,g]=(0,l.useState)([]),[b,f]=(0,l.useState)(!1),[w,k]=(0,l.useState)(!1),[S,A]=(0,l.useState)({type:"EMAIL",message:"",scheduledAt:new Date().toISOString().slice(0,16),customMessage:""}),[D,C]=(0,l.useState)(""),[E,M]=(0,l.useState)(""),T=async()=>{try{let e=await fetch("/api/payments/".concat(s,"/reminders")),a=await e.json();a.success&&g(a.data)}catch(e){console.error("Error loading reminders:",e)}};(0,l.useEffect)(()=>{T()},[s]);let P=async()=>{try{let e=await fetch("/api/payments/".concat(s,"/reminders"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:S.type,message:S.customMessage||I(),scheduledAt:S.scheduledAt})}),a=await e.json();a.success&&(f(!1),T(),N&&N(a.data))}catch(e){console.error("Error creating reminder:",e)}},L=async()=>{try{let e=await fetch("/api/payments/".concat(s,"/payment-link"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:a,description:"Оплата аренды: ".concat(m)})}),t=await e.json();t.success&&(C(t.data.paymentLink),M(t.data.qrCode),k(!0))}catch(e){console.error("Error generating payment link:",e)}},I=()=>{let e=Math.ceil((new Date(c).getTime()-new Date().getTime())/864e5);return e>0?"Добрый день! Напоминаем, что ".concat(e," ").concat(1===e?"день":"дней"," до оплаты аренды ").concat(m,". Сумма к оплате: ").concat(a.toLocaleString()," ₽. Хорошего дня!"):0===e?"Добрый день! Сегодня последний день для оплаты аренды ".concat(m,". Сумма к оплате: ").concat(a.toLocaleString()," ₽. Спасибо!"):"Добрый день! Платеж по аренде ".concat(m," просрочен на ").concat(Math.abs(e)," ").concat(1===Math.abs(e)?"день":"дней",". Сумма к оплате: ").concat(a.toLocaleString()," ₽. Просим произвести оплату в ближайшее время.")};return(0,l.useEffect)(()=>{S.customMessage||A(e=>({...e,message:I()}))},[S.type,c]),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)(n.zk,{className:"p-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[(0,t.jsx)(r.A,{className:"w-5 h-5 mr-2"}),"Контроль оплаты"]}),(0,t.jsx)(n.a,{variant:new Date(c)<new Date?"error":"info",children:new Date(c)<new Date?"Просрочен":"Активен"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[(0,t.jsxs)("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[(0,t.jsxs)("div",{className:"text-2xl font-bold text-blue-600",children:[a.toLocaleString()," ₽"]}),(0,t.jsx)("div",{className:"text-sm text-gray-600",children:"Сумма к оплате"})]}),(0,t.jsxs)("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[(0,t.jsx)("div",{className:"text-lg font-semibold text-gray-900",children:new Date(c).toLocaleDateString("ru-RU")}),(0,t.jsx)("div",{className:"text-sm text-gray-600",children:"Дата оплаты"})]}),(0,t.jsxs)("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[(0,t.jsx)("div",{className:"text-lg font-semibold text-gray-900",children:v.length}),(0,t.jsx)("div",{className:"text-sm text-gray-600",children:"Напоминаний"})]})]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsxs)(n.Pd,{onClick:()=>f(!0),className:"flex-1",children:[(0,t.jsx)(x.A,{className:"w-4 h-4 mr-2"}),"Настроить напоминание"]}),(0,t.jsxs)(n.Pd,{onClick:L,variant:"outline",className:"flex-1",children:[(0,t.jsx)(j.A,{className:"w-4 h-4 mr-2"}),"Создать ссылку для оплаты"]})]})]}),(0,t.jsxs)(n.zk,{className:"p-6",children:[(0,t.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,t.jsx)(x.A,{className:"w-5 h-5 mr-2"}),"История напоминаний"]}),0===v.length?(0,t.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,t.jsx)(x.A,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),(0,t.jsx)("p",{children:"Напоминания не настроены"})]}):(0,t.jsx)("div",{className:"space-y-3",children:v.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(e=>{switch(e){case"SENT":return(0,t.jsx)(o.A,{className:"w-4 h-4 text-green-600"});case"SCHEDULED":return(0,t.jsx)(h.A,{className:"w-4 h-4 text-blue-600"});case"FAILED":return(0,t.jsx)(u.A,{className:"w-4 h-4 text-red-600"});default:return(0,t.jsx)(h.A,{className:"w-4 h-4 text-gray-600"})}})(e.status),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium text-gray-900",children:"EMAIL"===e.type?"Email":"SMS"===e.type?"SMS":"WhatsApp"}),(0,t.jsx)("div",{className:"text-sm text-gray-600",children:e.scheduledAt?new Date(e.scheduledAt).toLocaleString("ru-RU"):"Не запланировано"})]})]}),(0,t.jsx)("div",{className:"flex items-center space-x-2",children:(e=>{switch(e){case"SENT":return(0,t.jsx)(n.a,{variant:"success",children:"Отправлено"});case"SCHEDULED":return(0,t.jsx)(n.a,{variant:"info",children:"Запланировано"});case"FAILED":return(0,t.jsx)(n.a,{variant:"error",children:"Ошибка"});default:return(0,t.jsx)(n.a,{variant:"default",children:"Неизвестно"})}})(e.status)})]},e.id))})]}),(0,t.jsx)(n.ih,{isOpen:b,onClose:()=>f(!1),title:"Настройка автоматического напоминания",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Тип уведомления"}),(0,t.jsx)(n.H1,{options:[{value:"EMAIL",label:"Email"},{value:"SMS",label:"SMS"},{value:"WHATSAPP",label:"WhatsApp"}],value:S.type,onChange:e=>A(s=>({...s,type:e}))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Дата и время отправки"}),(0,t.jsx)(n.V$,{type:"datetime-local",value:S.scheduledAt,onChange:e=>A(s=>({...s,scheduledAt:e.target.value}))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Сообщение"}),(0,t.jsx)("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:4,value:S.customMessage||I(),onChange:e=>A(s=>({...s,customMessage:e.target.value})),placeholder:"Введите текст сообщения..."})]}),(0,t.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,t.jsxs)(n.Pd,{onClick:P,className:"flex-1",children:[(0,t.jsx)(p.A,{className:"w-4 h-4 mr-2"}),"Создать напоминание"]}),(0,t.jsx)(n.Pd,{onClick:()=>f(!1),variant:"outline",children:"Отмена"})]})]})}),(0,t.jsx)(n.ih,{isOpen:w,onClose:()=>k(!1),title:"Ссылка для оплаты",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsx)(y,{className:"w-32 h-32 mx-auto text-blue-600"})}),(0,t.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"Отсканируйте QR-код или перейдите по ссылке для оплаты"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ссылка для оплаты"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("input",{type:"text",value:D,readOnly:!0,className:"flex-1 px-3 py-2 border border-gray-300 rounded-md bg-gray-50"}),(0,t.jsx)(n.Pd,{onClick:()=>navigator.clipboard.writeText(D),variant:"outline",size:"sm",children:"Копировать"})]})]}),(0,t.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,t.jsxs)(n.Pd,{onClick:()=>window.open(D,"_blank"),className:"flex-1",children:[(0,t.jsx)(j.A,{className:"w-4 h-4 mr-2"}),"Перейти к оплате"]}),(0,t.jsx)(n.Pd,{onClick:()=>k(!1),variant:"outline",children:"Закрыть"})]})]})})]})}var v=a(91788);function g(e){var s,a;let{isOpen:r,onClose:c,payment:i,onSuccess:x}=e,[m,h]=(0,l.useState)({invoiceNumber:"",dueDate:"",notes:"",includeBreakdown:!0}),[j,y]=(0,l.useState)(!1),[N,g]=(0,l.useState)(!1),[b,f]=(0,l.useState)(""),[w,k]=(0,l.useState)(null),S=async e=>{e.preventDefault(),y(!0),f("");try{let e=await fetch("/api/payments/generate-invoice",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paymentId:i.id,...m})}),s=await e.json();s.success?(k(s.data),g(!0),x&&x(s.data),setTimeout(()=>{c(),g(!1),k(null)},2e3)):f(s.error||"Ошибка при создании счета")}catch(e){console.error("Error creating invoice:",e),f("Ошибка при создании счета")}finally{y(!1)}},A=async()=>{if(w)try{let e=await fetch("/api/payments/send-reminder",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paymentId:i.id,reminderType:"EMAIL",includeInvoice:!0})}),s=await e.json();s.success?alert("Счет отправлен арендатору"):alert("Ошибка при отправке счета: "+s.error)}catch(e){console.error("Error sending invoice:",e),alert("Ошибка при отправке счета")}};return(0,t.jsx)(n.ih,{isOpen:r,onClose:c,size:"lg",children:(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsxs)("div",{className:"flex items-center mb-6",children:[(0,t.jsx)(d.A,{className:"w-6 h-6 text-blue-600 mr-3"}),(0,t.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Создать счет"})]}),N?(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(o.A,{className:"w-16 h-16 text-green-500 mx-auto mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Счет успешно создан!"}),(0,t.jsxs)("p",{className:"text-gray-600 mb-6",children:["Номер счета: ",null==w||null==(a=w.invoiceData)?void 0:a.invoiceNumber]}),(0,t.jsxs)("div",{className:"flex gap-3 justify-center",children:[(0,t.jsxs)(n.Pd,{onClick:()=>{(null==w?void 0:w.pdfUrl)&&window.open(w.pdfUrl,"_blank")},children:[(0,t.jsx)(v.A,{className:"w-4 h-4 mr-2"}),"Скачать PDF"]}),(0,t.jsxs)(n.Pd,{onClick:A,variant:"outline",children:[(0,t.jsx)(p.A,{className:"w-4 h-4 mr-2"}),"Отправить"]})]})]}):(0,t.jsxs)("form",{onSubmit:S,className:"space-y-6",children:[(0,t.jsxs)(n.zk,{className:"p-4 bg-gray-50",children:[(0,t.jsx)("h3",{className:"font-semibold text-gray-900 mb-3",children:"Информация о платеже"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Тип:"}),(0,t.jsx)("p",{className:"font-medium",children:(e=>{switch(e){case"RENT":return"Арендная плата";case"UTILITIES":return"Коммунальные услуги";case"DEPOSIT":return"Депозит";case"MAINTENANCE":return"Обслуживание";default:return"Платеж"}})(null==i?void 0:i.type)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Сумма:"}),(0,t.jsxs)("p",{className:"font-medium",children:[null==i||null==(s=i.amount)?void 0:s.toLocaleString()," ₽"]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Статус:"}),(0,t.jsx)("p",{className:"font-medium",children:(e=>{switch(e){case"PAID":return"Оплачен";case"PENDING":return"Ожидает оплаты";case"OVERDUE":return"Просрочен";default:return"Неизвестно"}})(null==i?void 0:i.status)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Срок:"}),(0,t.jsx)("p",{className:"font-medium",children:(null==i?void 0:i.dueDate)?new Date(i.dueDate).toLocaleDateString("ru-RU"):"Не указан"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(n.V$,{label:"Номер счета",placeholder:"Автоматически генерируется",value:m.invoiceNumber,onChange:e=>h(s=>({...s,invoiceNumber:e.target.value})),disabled:!0}),(0,t.jsx)(n.V$,{label:"Срок оплаты",type:"date",value:m.dueDate,onChange:e=>h(s=>({...s,dueDate:e.target.value})),required:!0}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Дополнительные примечания"}),(0,t.jsx)("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,placeholder:"Дополнительная информация для счета...",value:m.notes,onChange:e=>h(s=>({...s,notes:e.target.value}))})]}),(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("input",{type:"checkbox",id:"includeBreakdown",checked:m.includeBreakdown,onChange:e=>h(s=>({...s,includeBreakdown:e.target.checked})),className:"mr-2"}),(0,t.jsx)("label",{htmlFor:"includeBreakdown",className:"text-sm text-gray-700",children:"Включить детализацию платежей"})]})]}),b&&(0,t.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(u.A,{className:"w-4 h-4 text-red-400 mr-2"}),(0,t.jsx)("span",{className:"text-sm text-red-700",children:b})]})}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsxs)(n.Pd,{type:"submit",loading:j,className:"flex-1",children:[(0,t.jsx)(d.A,{className:"w-4 h-4 mr-2"}),"Создать счет"]}),(0,t.jsx)(n.Pd,{type:"button",onClick:c,variant:"outline",children:"Отмена"})]})]})]})})}var b=a(90490),f=a(81497),w=a(28883);function k(e){let{payment:s,onSendReminder:a}=e,l=s.reminderSentAt||s.reminderCount>0,r="OVERDUE"===s.status&&s.dueDate&&new Date(s.dueDate)<new Date,c=l?s.reminderCount>=3?{label:"Максимум напоминаний",variant:"error",icon:(0,t.jsx)(u.A,{className:"w-4 h-4"})}:{label:"Напоминание отправлено (".concat(s.reminderCount,")"),variant:"warning",icon:(0,t.jsx)(o.A,{className:"w-4 h-4"})}:{label:"Напоминание не отправлено",variant:"default",icon:(0,t.jsx)(h.A,{className:"w-4 h-4"})};return(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[c.icon,(0,t.jsx)(n.a,{variant:c.variant,children:c.label})]}),l&&(0,t.jsxs)("div",{className:"text-xs text-gray-500",children:[s.reminderSentAt&&(0,t.jsxs)("div",{children:["Последнее: ",new Date(s.reminderSentAt).toLocaleDateString("ru-RU")]}),s.lastReminderType&&(0,t.jsxs)("div",{className:"flex items-center",children:["SMS"===s.lastReminderType?(0,t.jsx)(f.A,{className:"w-4 h-4"}):(0,t.jsx)(w.A,{className:"w-4 h-4"}),(0,t.jsx)("span",{className:"ml-1",children:"SMS"===s.lastReminderType?"SMS":"Email"})]})]})]}),"PENDING"===s.status&&s.reminderCount<3&&(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(n.Pd,{onClick:()=>{a&&a(s.id,"EMAIL")},variant:"outline",size:"sm",className:"flex-1",children:[(0,t.jsx)(w.A,{className:"w-4 h-4 mr-2"}),"Email"]}),(0,t.jsxs)(n.Pd,{onClick:()=>{a&&a(s.id,"SMS")},variant:"outline",size:"sm",className:"flex-1",children:[(0,t.jsx)(f.A,{className:"w-4 h-4 mr-2"}),"SMS"]})]}),r&&(0,t.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(u.A,{className:"w-4 h-4 text-red-400 mr-2"}),(0,t.jsxs)("span",{className:"text-sm text-red-700",children:["Платеж просрочен на ",Math.floor((new Date().getTime()-new Date(s.dueDate).getTime())/864e5)," дней"]})]})}),l&&s.reminderCount<3&&(0,t.jsxs)("div",{className:"text-xs text-gray-500",children:["Следующее напоминание можно отправить через"," ",s.reminderSentAt?Math.max(0,24-Math.floor((new Date().getTime()-new Date(s.reminderSentAt).getTime())/36e5))+" ч":"сейчас"]})]})}var S=a(59434);function A(){var e,s,a,o,h;let[u,j]=(0,l.useState)([]),[p,y]=(0,l.useState)(!0),[v,f]=(0,l.useState)(null),[w,A]=(0,l.useState)(!1),[D,C]=(0,l.useState)(!1),[E,M]=(0,l.useState)(null),[T,P]=(0,l.useState)({status:"",type:"",dateFrom:"",dateTo:""}),L=async()=>{y(!0);try{let e=new URLSearchParams;T.status&&e.append("status",T.status),T.type&&e.append("type",T.type),T.dateFrom&&e.append("dateFrom",T.dateFrom),T.dateTo&&e.append("dateTo",T.dateTo);let s=await fetch("/api/payments?".concat(e)),a=await s.json();a.success&&j(a.data)}catch(e){console.error("Error loading payments:",e)}finally{y(!1)}};(0,l.useEffect)(()=>{L()},[T]);let I=[{value:"RENT",label:"Арендная плата"},{value:"UTILITIES",label:"Коммунальные услуги"},{value:"DEPOSIT",label:"Депозит"},{value:"MAINTENANCE",label:"Обслуживание"}],O=u.filter(e=>"PAID"===e.status).reduce((e,s)=>e+s.amount,0),z=u.filter(e=>"PENDING"===e.status).reduce((e,s)=>e+s.amount,0),R=u.filter(e=>"OVERDUE"===e.status).reduce((e,s)=>e+s.amount,0),U=async(e,s)=>{try{let a=await fetch("/api/payments/send-reminder",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paymentId:e,reminderType:s})}),t=await a.json();t.success?(alert("Напоминание отправлено арендатору: ".concat(t.data.recipient.name)),L()):alert("Ошибка при отправке напоминания: "+t.error)}catch(e){console.error("Error sending reminder:",e),alert("Ошибка при отправке напоминания")}};return(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50 py-8",children:[(0,t.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 mb-4 flex items-center",children:[(0,t.jsx)(r.A,{className:"w-8 h-8 mr-3 text-blue-600"}),"Платежи и расчеты"]}),(0,t.jsx)("p",{className:"text-lg text-gray-600",children:"Автоматизация расчетов арендной платы, коммунальных услуг и депозитов"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[(0,t.jsxs)(n.zk,{className:"p-6 text-center",children:[(0,t.jsx)("div",{className:"text-3xl font-bold text-green-600 mb-2",children:(0,S.Nx)(O)}),(0,t.jsx)("div",{className:"text-gray-600",children:"Общий доход"})]}),(0,t.jsxs)(n.zk,{className:"p-6 text-center",children:[(0,t.jsx)("div",{className:"text-3xl font-bold text-yellow-600 mb-2",children:(0,S.Nx)(z)}),(0,t.jsx)("div",{className:"text-gray-600",children:"Ожидает оплаты"})]}),(0,t.jsxs)(n.zk,{className:"p-6 text-center",children:[(0,t.jsx)("div",{className:"text-3xl font-bold text-red-600 mb-2",children:(0,S.Nx)(R)}),(0,t.jsx)("div",{className:"text-gray-600",children:"Просроченные платежи"})]}),(0,t.jsxs)(n.zk,{className:"p-6 text-center",children:[(0,t.jsx)("div",{className:"text-3xl font-bold text-blue-600 mb-2",children:u.length}),(0,t.jsx)("div",{className:"text-gray-600",children:"Всего операций"})]})]}),E&&(0,t.jsx)("div",{className:"mb-8",children:(0,t.jsx)(N,{paymentId:E.id,amount:E.amount,dueDate:new Date(E.dueDate),tenantEmail:null==(s=E.deal)||null==(e=s.tenant)?void 0:e.email,tenantPhone:null==(o=E.deal)||null==(a=o.tenant)?void 0:a.phone,propertyTitle:null==(h=E.property)?void 0:h.title,onReminderSent:e=>{alert("Напоминание успешно создано")}})}),(0,t.jsxs)(n.zk,{className:"p-6 mb-8",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Фильтры"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-[#323130] mb-2",children:"Статус"}),(0,t.jsx)(n.H1,{options:[{value:"PENDING",label:"Ожидает оплаты"},{value:"PAID",label:"Оплачен"},{value:"OVERDUE",label:"Просрочен"},{value:"CANCELLED",label:"Отменен"}],value:T.status,onChange:e=>P(s=>({...s,status:e})),placeholder:"Все статусы"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-[#323130] mb-2",children:"Тип платежа"}),(0,t.jsx)(n.H1,{options:I,value:T.type,onChange:e=>P(s=>({...s,type:e})),placeholder:"Все типы"})]}),(0,t.jsx)(n.V$,{label:"Дата с",type:"date",value:T.dateFrom,onChange:e=>P(s=>({...s,dateFrom:e.target.value}))}),(0,t.jsx)(n.V$,{label:"Дата по",type:"date",value:T.dateTo,onChange:e=>P(s=>({...s,dateTo:e.target.value}))})]})]}),(0,t.jsxs)("div",{className:"space-y-4 mb-8",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"История платежей"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(n.Pd,{onClick:L,variant:"outline",size:"sm",children:[(0,t.jsx)(c.A,{className:"w-4 h-4 mr-2"}),"Обновить"]}),(0,t.jsxs)(n.Pd,{onClick:()=>C(!0),children:[(0,t.jsx)(i.A,{className:"w-4 h-4 mr-2"}),"Создать платежи"]})]})]}),p?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),(0,t.jsx)("p",{className:"text-gray-600 mt-2",children:"Загрузка платежей..."})]}):0===u.length?(0,t.jsxs)(n.zk,{className:"p-8 text-center",children:[(0,t.jsx)(r.A,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-gray-600 mb-4",children:"Платежи не найдены"}),(0,t.jsx)(n.Pd,{onClick:()=>C(!0),children:"Создать первый платеж"})]}):u.map(e=>{var s,a,l,r,c,i,m,o,h,u,j,p,y;return(0,t.jsxs)(n.zk,{className:"p-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h3",{className:"font-semibold text-gray-900 mb-1",children:(null==(a=e.deal)||null==(s=a.property)?void 0:s.title)||(null==(l=e.property)?void 0:l.title)||"Объект не указан"}),(0,t.jsxs)("div",{className:"text-sm text-gray-600 space-y-1",children:[(0,t.jsxs)("div",{children:["Арендатор: ",(null==(c=e.deal)||null==(r=c.tenant)?void 0:r.firstName)&&(null==(m=e.deal)||null==(i=m.tenant)?void 0:i.lastName)?"".concat(e.deal.tenant.firstName," ").concat(e.deal.tenant.lastName):(null==(h=e.deal)||null==(o=h.client)?void 0:o.firstName)&&(null==(j=e.deal)||null==(u=j.client)?void 0:u.lastName)?"".concat(e.deal.client.firstName," ").concat(e.deal.client.lastName):"Не указан"]}),(0,t.jsxs)("div",{children:["Тип: ",(p=e.type,(null==(y=I.find(e=>e.value===p))?void 0:y.label)||p)]}),(0,t.jsxs)("div",{children:["Дата: ",e.dueDate?new Date(e.dueDate).toLocaleDateString("ru-RU"):"Не указана"]}),e.invoiceNumber&&(0,t.jsxs)("div",{children:["Счет: ",e.invoiceNumber]}),e.reminderSentAt&&(0,t.jsxs)("div",{className:"text-yellow-600",children:["Напоминание отправлено: ",new Date(e.reminderSentAt).toLocaleDateString("ru-RU")]})]})]}),(0,t.jsxs)("div",{className:"text-right ml-4",children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-gray-900 mb-2",children:(0,S.Nx)(e.amount)}),(e=>{switch(e){case"PAID":return(0,t.jsx)(n.a,{variant:"success",children:"Оплачен"});case"PENDING":return(0,t.jsx)(n.a,{variant:"warning",children:"Ожидает оплаты"});case"OVERDUE":return(0,t.jsx)(n.a,{variant:"error",children:"Просрочен"});case"CANCELLED":return(0,t.jsx)(n.a,{variant:"default",children:"Отменен"});default:return(0,t.jsx)(n.a,{variant:"default",children:"Неизвестно"})}})(e.status)]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(n.Pd,{onClick:()=>{f(e),A(!0)},variant:"outline",size:"sm",children:[(0,t.jsx)(d.A,{className:"w-4 h-4 mr-2"}),"Создать счет"]}),(0,t.jsxs)(n.Pd,{onClick:()=>{M(e)},variant:"outline",size:"sm",children:[(0,t.jsx)(x.A,{className:"w-4 h-4 mr-2"}),"Контроль оплаты"]})]}),(0,t.jsx)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:(0,t.jsx)(k,{payment:e,onSendReminder:U})})]},e.id)})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,t.jsxs)(n.zk,{className:"p-6 text-center",children:[(0,t.jsx)(x.A,{className:"w-12 h-12 text-blue-600 mx-auto mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Автоматические напоминания"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Настройте автоматическую отправку напоминаний с персональными сообщениями"})]}),(0,t.jsxs)(n.zk,{className:"p-6 text-center",children:[(0,t.jsx)(r.A,{className:"w-12 h-12 text-green-600 mx-auto mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Оплата по ссылке"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Создавайте ссылки и QR-коды для быстрой оплаты арендаторами"})]}),(0,t.jsxs)(n.zk,{className:"p-6 text-center",children:[(0,t.jsx)(m.A,{className:"w-12 h-12 text-purple-600 mx-auto mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Контроль платежей"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Отслеживайте статус платежей и управляйте процессом оплаты"})]})]})]}),v&&(0,t.jsx)(g,{isOpen:w,onClose:()=>{A(!1),f(null)},payment:v,onSuccess:()=>{L()}}),(0,t.jsx)(b.A,{isOpen:D,onClose:()=>C(!1),onSuccess:()=>{L()},deals:[],contracts:[]})]})}},22915:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(72895).A)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},27414:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(72895).A)("Banknote",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]])},28883:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(72895).A)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]])},38164:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(72895).A)("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]])},81497:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(72895).A)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]])},84616:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(72895).A)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},90490:(e,s,a)=>{"use strict";a.d(s,{A:()=>i});var t=a(95155),l=a(12115),n=a(41665),r=a(57434),c=a(27414);function i(e){var s,a,i,d,x,m;let{isOpen:o,onClose:h,onSuccess:u,deals:j=[],contracts:p=[]}=e,[y,N]=(0,l.useState)(!1),[v,g]=(0,l.useState)([]),[b,f]=(0,l.useState)(""),[w,k]=(0,l.useState)("deal"),[S,A]=(0,l.useState)(""),[D,C]=(0,l.useState)(j),[E,M]=(0,l.useState)(p);(0,l.useEffect)(()=>{o&&(T(),P())},[o]);let T=async()=>{try{let e=await fetch("/api/deals"),s=await e.json();s.success&&C(s.data)}catch(e){console.error("Error loading deals:",e)}},P=async()=>{try{let e=await fetch("/api/contracts"),s=await e.json();s.success&&M(s.data)}catch(e){console.error("Error loading contracts:",e)}},L=async e=>{e.preventDefault(),N(!0),g([]),f("");try{let e=await fetch("/api/payments/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dealId:"deal"===w?S:void 0,contractId:"contract"===w?S:void 0})}),s=await e.json();s.success?(f(s.message||"Платежи успешно сгенерированы"),setTimeout(()=>{f(""),h(),u()},2e3)):g([s.error||"Ошибка при генерации платежей"])}catch(e){console.error("Error generating payments:",e),g(["Ошибка при генерации платежей"])}finally{N(!1)}},I="deal"===w?D.find(e=>e.id===S):null==(s=E.find(e=>e.id===S))?void 0:s.deal;return(0,t.jsx)(n.ih,{isOpen:o,onClose:h,title:"Генерация платежей",children:(0,t.jsxs)("form",{onSubmit:L,className:"space-y-6",children:[v.length>0&&(0,t.jsx)(n.N6,{variant:"error",title:"Ошибка",children:(0,t.jsx)("ul",{className:"list-disc list-inside",children:v.map((e,s)=>(0,t.jsx)("li",{children:e},s))})}),b&&(0,t.jsx)(n.N6,{variant:"success",title:"Успешно",children:b}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("h3",{className:"text-lg font-medium text-[#323130] mb-4 flex items-center",children:[(0,t.jsx)(r.A,{className:"w-5 h-5 mr-2"}),"Выбор источника данных"]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-[#323130] mb-1",children:"Тип сущности"}),(0,t.jsx)(n.H1,{value:w,onChange:e=>{k(e),A("")},options:[{value:"deal",label:"Сделка"},{value:"contract",label:"Договор"}]})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"block text-sm font-medium text-[#323130] mb-1",children:["Выберите ","deal"===w?"сделку":"договор"]}),(0,t.jsx)(n.H1,{value:S,onChange:A,options:"deal"===w?[{value:"",label:"Выберите сделку"},...D.map(e=>{var s;return{value:e.id,label:"".concat(e.title," (").concat(null==(s=e.monthlyRent)?void 0:s.toLocaleString()," ₽/мес)")}})]:[{value:"",label:"Выберите договор"},...E.map(e=>{var s;return{value:e.id,label:"".concat(e.title," (").concat(null==(s=e.deal.monthlyRent)?void 0:s.toLocaleString()," ₽/мес)")}})]})]})]})]}),I&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("h3",{className:"text-lg font-medium text-[#323130] mb-4 flex items-center",children:[(0,t.jsx)(c.A,{className:"w-5 h-5 mr-2"}),"Информация для генерации"]}),(0,t.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg space-y-2 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Объект:"})," ",null==(a=I.property)?void 0:a.title," - ",null==(i=I.property)?void 0:i.address]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Арендатор:"})," ",null==(d=I.tenant)?void 0:d.firstName," ",null==(x=I.tenant)?void 0:x.lastName]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Сумма аренды:"})," ",null==(m=I.monthlyRent)?void 0:m.toLocaleString()," ₽/мес"]}),I.deposit&&(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Залог:"})," ",I.deposit.toLocaleString()," ₽"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Период:"})," ",I.startDate," - ",I.endDate||"неопределенный срок"]})]}),(0,t.jsxs)("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg",children:[(0,t.jsx)("h4",{className:"font-medium text-blue-900 mb-2",children:"Будет сгенерировано:"}),(0,t.jsxs)("ul",{className:"text-sm text-blue-800 space-y-1",children:[(0,t.jsx)("li",{children:"• Ежемесячные платежи за аренду (5-е число каждого месяца)"}),I.deposit&&(0,t.jsx)("li",{children:"• Платеж за залог (в день начала аренды)"}),(0,t.jsxs)("li",{children:["• Все платежи будут привязаны к ","deal"===w?"сделке":"договору"]})]})]})]}),(0,t.jsxs)("div",{className:"flex justify-end space-x-3 pt-6 border-t border-gray-200",children:[(0,t.jsx)(n.Pd,{type:"button",variant:"outline",onClick:h,disabled:y,children:"Отмена"}),(0,t.jsx)(n.Pd,{type:"submit",disabled:y||!S,children:y?"Генерация...":"Сгенерировать платежи"})]})]})})}},91788:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(72895).A)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])}},e=>{e.O(0,[7910,1665,8441,5964,7358],()=>e(e.s=16525)),_N_E=e.O()}]);