(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3529],{15874:(e,s,l)=>{Promise.resolve().then(l.bind(l,38503))},35695:(e,s,l)=>{"use strict";var n=l(18999);l.o(n,"useParams")&&l.d(s,{useParams:function(){return n.useParams}}),l.o(n,"usePathname")&&l.d(s,{usePathname:function(){return n.usePathname}}),l.o(n,"useRouter")&&l.d(s,{useRouter:function(){return n.useRouter}})},38503:(e,s,l)=>{"use strict";l.r(s),l.d(s,{default:()=>t});var n=l(95155),r=l(54789);function t(){let{user:e,isAuthenticated:s,loading:l}=(0,r.n)();return l?(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"}),(0,n.jsx)("p",{className:"mt-4 text-gray-600",children:"Загрузка..."})]})}):(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 py-12",children:(0,n.jsxs)("div",{className:"max-w-4xl mx-auto px-4",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-8",children:"Тест статуса авторизации"}),(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Текущее состояние:"}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Авторизован:"})," ",s?"✅ Да":"❌ Нет"]}),e&&(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Пользователь:"}),(0,n.jsx)("pre",{className:"mt-2 p-4 bg-gray-100 rounded text-sm overflow-auto",children:JSON.stringify(e,null,2)})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Загрузка:"})," ",l?"\uD83D\uDD04 Да":"✅ Нет"]})]}),(0,n.jsxs)("div",{className:"mt-8 space-y-4",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold",children:"Действия:"}),s?(0,n.jsxs)("div",{className:"space-x-4",children:[(0,n.jsx)("a",{href:"/dashboard",className:"inline-block bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",children:"Перейти в Dashboard"}),(0,n.jsx)("a",{href:"/deals",className:"inline-block bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"Перейти в Сделки"}),(0,n.jsx)("a",{href:"/clients",className:"inline-block bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700",children:"Перейти в Клиенты"})]}):(0,n.jsx)("div",{children:(0,n.jsx)("a",{href:"/login",className:"inline-block bg-primary-600 text-white px-4 py-2 rounded hover:bg-primary-700",children:"Войти"})})]})]})]})})}},54789:(e,s,l)=>{"use strict";l.d(s,{AppProvider:()=>i,n:()=>a});var n=l(95155),r=l(12115),t=l(35695);let o=(0,r.createContext)(void 0);function i(e){let{children:s}=e,[l,i]=(0,r.useState)(null),[a,c]=(0,r.useState)(!0),d=(0,t.useRouter)(),u=(0,t.usePathname)(),h=async()=>{try{let e=await fetch("/api/auth/me",{credentials:"include"});if(e.ok){let s=await e.json();s.success&&s.user?(i(s.user),console.log("✅ Пользователь авторизован:",s.user.email)):(i(null),console.log("❌ Пользователь не авторизован"))}else i(null),console.log("❌ Ошибка проверки авторизации:",e.status)}catch(e){console.error("Ошибка проверки авторизации:",e),i(null)}finally{c(!1)}},m=async()=>{try{console.log("\uD83D\uDEAA Выполняется выход из системы..."),await fetch("/api/auth/logout",{method:"POST",credentials:"include"})}catch(e){console.error("Ошибка выхода:",e)}finally{i(null),console.log("✅ Выход выполнен, перенаправление на /login"),window.location.href="/login"}};return(0,r.useEffect)(()=>{h()},[]),(0,r.useEffect)(()=>{!a&&(l&&("/login"===u||"/register"===u)?(console.log("\uD83D\uDD04 Авторизованный пользователь на странице входа, перенаправляем на home"),window.location.href="/home"):l&&"/"===u?(console.log("\uD83D\uDD04 Авторизованный пользователь на главной странице, перенаправляем на home"),window.location.href="/home"):l||"/login"===u||"/register"===u||"/"===u||(console.log("\uD83D\uDEE1️ Попытка доступа к защищенной странице без авторизации"),d.push("/login")))},[l,a,u,d]),(0,n.jsx)(o.Provider,{value:{user:l,isAuthenticated:!!l,loading:a,login:e=>{i(e),c(!1),console.log("✅ Пользователь авторизован:",e.email)},logout:m,checkAuth:h},children:s})}function a(){let e=(0,r.useContext)(o);if(void 0===e)throw Error("useApp must be used within an AppProvider");return e}}},e=>{e.O(0,[8441,5964,7358],()=>e(e.s=15874)),_N_E=e.O()}]);