(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2580],{35695:(e,s,n)=>{"use strict";var t=n(18999);n.o(t,"useParams")&&n.d(s,{useParams:function(){return t.useParams}}),n.o(t,"usePathname")&&n.d(s,{usePathname:function(){return t.usePathname}}),n.o(t,"useRouter")&&n.d(s,{useRouter:function(){return t.useRouter}})},54789:(e,s,n)=>{"use strict";n.d(s,{AppProvider:()=>a,n:()=>i});var t=n(95155),l=n(12115),o=n(35695);let r=(0,l.createContext)(void 0);function a(e){let{children:s}=e,[n,a]=(0,l.useState)(null),[i,c]=(0,l.useState)(!0),u=(0,o.useRouter)(),d=(0,o.usePathname)(),h=async()=>{try{let e=await fetch("/api/auth/me",{credentials:"include"});if(e.ok){let s=await e.json();s.success&&s.user?(a(s.user),console.log("✅ Пользователь авторизован:",s.user.email)):(a(null),console.log("❌ Пользователь не авторизован"))}else a(null),console.log("❌ Ошибка проверки авторизации:",e.status)}catch(e){console.error("Ошибка проверки авторизации:",e),a(null)}finally{c(!1)}},m=async()=>{try{console.log("\uD83D\uDEAA Выполняется выход из системы..."),await fetch("/api/auth/logout",{method:"POST",credentials:"include"})}catch(e){console.error("Ошибка выхода:",e)}finally{a(null),console.log("✅ Выход выполнен, перенаправление на /login"),window.location.href="/login"}};return(0,l.useEffect)(()=>{h()},[]),(0,l.useEffect)(()=>{!i&&(n&&("/login"===d||"/register"===d)?(console.log("\uD83D\uDD04 Авторизованный пользователь на странице входа, перенаправляем на home"),window.location.href="/home"):n&&"/"===d?(console.log("\uD83D\uDD04 Авторизованный пользователь на главной странице, перенаправляем на home"),window.location.href="/home"):n||"/login"===d||"/register"===d||"/"===d||(console.log("\uD83D\uDEE1️ Попытка доступа к защищенной странице без авторизации"),u.push("/login")))},[n,i,d,u]),(0,t.jsx)(r.Provider,{value:{user:n,isAuthenticated:!!n,loading:i,login:e=>{a(e),c(!1),console.log("✅ Пользователь авторизован:",e.email)},logout:m,checkAuth:h},children:s})}function i(){let e=(0,l.useContext)(r);if(void 0===e)throw Error("useApp must be used within an AppProvider");return e}},64207:(e,s,n)=>{Promise.resolve().then(n.bind(n,83558))},83558:(e,s,n)=>{"use strict";n.r(s),n.d(s,{default:()=>r});var t=n(95155),l=n(12115),o=n(54789);function r(){let{user:e,isAuthenticated:s,loading:n}=(0,o.n)(),[r,a]=(0,l.useState)("Проверка...");return(0,l.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/auth/me",{credentials:"include"}),s=await e.json();a("API ответ: ".concat(JSON.stringify(s,null,2)))}catch(e){a("Ошибка: ".concat(e))}})()},[]),(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 p-8",children:(0,t.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold mb-8",children:"Тест авторизации"}),(0,t.jsxs)("div",{className:"bg-white rounded-lg p-6 mb-6",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Состояние AppProvider:"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Loading:"})," ",n?"Да":"Нет"]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"isAuthenticated:"})," ",s?"Да":"Нет"]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"User:"})," ",e?JSON.stringify(e,null,2):"Нет"]})]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-lg p-6",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"API /auth/me:"}),(0,t.jsx)("pre",{className:"bg-gray-100 p-4 rounded text-sm overflow-auto",children:r})]}),(0,t.jsx)("div",{className:"mt-6",children:(0,t.jsx)("a",{href:"/login",className:"text-blue-600 hover:underline",children:"Перейти на страницу входа"})})]})})}}},e=>{e.O(0,[8441,5964,7358],()=>e(e.s=64207)),_N_E=e.O()}]);