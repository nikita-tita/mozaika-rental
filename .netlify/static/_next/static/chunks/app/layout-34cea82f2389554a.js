(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7177],{30347:()=>{},35695:(e,o,n)=>{"use strict";var t=n(18999);n.o(t,"useParams")&&n.d(o,{useParams:function(){return t.useParams}}),n.o(t,"usePathname")&&n.d(o,{usePathname:function(){return t.usePathname}}),n.o(t,"useRouter")&&n.d(o,{useRouter:function(){return t.useRouter}})},54789:(e,o,n)=>{"use strict";n.d(o,{AppProvider:()=>u,n:()=>i});var t=n(95155),s=n(12115),l=n(35695);let r=(0,s.createContext)(void 0);function u(e){let{children:o}=e,[n,u]=(0,s.useState)(null),[i,a]=(0,s.useState)(!0),c=(0,l.useRouter)(),h=(0,l.usePathname)(),d=async()=>{try{let e=await fetch("/api/auth/me",{credentials:"include"});if(e.ok){let o=await e.json();o.success&&o.user?(u(o.user),console.log("✅ Пользователь авторизован:",o.user.email)):(u(null),console.log("❌ Пользователь не авторизован"))}else u(null),console.log("❌ Ошибка проверки авторизации:",e.status)}catch(e){console.error("Ошибка проверки авторизации:",e),u(null)}finally{a(!1)}},f=async()=>{try{console.log("\uD83D\uDEAA Выполняется выход из системы..."),await fetch("/api/auth/logout",{method:"POST",credentials:"include"})}catch(e){console.error("Ошибка выхода:",e)}finally{u(null),console.log("✅ Выход выполнен, перенаправление на /login"),window.location.href="/login"}};return(0,s.useEffect)(()=>{d()},[]),(0,s.useEffect)(()=>{!i&&(n&&("/login"===h||"/register"===h)?(console.log("\uD83D\uDD04 Авторизованный пользователь на странице входа, перенаправляем на home"),window.location.href="/home"):n&&"/"===h?(console.log("\uD83D\uDD04 Авторизованный пользователь на главной странице, перенаправляем на home"),window.location.href="/home"):n||"/login"===h||"/register"===h||"/"===h||(console.log("\uD83D\uDEE1️ Попытка доступа к защищенной странице без авторизации"),c.push("/login")))},[n,i,h,c]),(0,t.jsx)(r.Provider,{value:{user:n,isAuthenticated:!!n,loading:i,login:e=>{u(e),a(!1),console.log("✅ Пользователь авторизован:",e.email)},logout:f,checkAuth:d},children:o})}function i(){let e=(0,s.useContext)(r);if(void 0===e)throw Error("useApp must be used within an AppProvider");return e}},72609:(e,o,n)=>{Promise.resolve().then(n.t.bind(n,30347,23)),Promise.resolve().then(n.bind(n,54789))}},e=>{e.O(0,[7690,8441,5964,7358],()=>e(e.s=72609)),_N_E=e.O()}]);