# Исправления проблем электронной подписи

## Проблемы, которые были исправлены:

### 1. ✅ Загрузка файлов документов
**Проблема**: API `/api/upload` принимал только изображения, но для электронной подписи нужны документы (PDF, DOC, DOCX).

**Решение**:
- Создан новый API endpoint `/api/upload/document` специально для документов
- Поддерживаемые форматы: PDF, DOC, DOCX, XLS, XLSX
- Увеличен лимит размера файла до 50MB
- Добавлена валидация типов файлов на клиенте

### 2. ✅ Улучшен выбор подписантов
**Проблема**: Неудобно выбирались подписанты, не было возможности добавить нового.

**Решение**:
- Добавлена кнопка "Добавить нового подписанта" в компонент `SignerSelector`
- Создана форма для добавления нового подписанта с полями:
  - Имя (обязательно)
  - Фамилия (обязательно)
  - Email (опционально)
  - Телефон (обязательно)
  - Роль (арендодатель/арендатор/риелтор/свидетель)
- Новый подписант автоматически создается как клиент и добавляется в список
- Добавлен поиск по имени, email и телефону

### 3. ✅ Исправлено отображение выбранных подписантов
**Проблема**: Выбранные подписанты отображались белым текстом на белом фоне.

**Решение**:
- Изменен фон выбранных подписантов на синий (`bg-blue-900`)
- Добавлена рамка (`border-blue-700`)
- Текст сделан белым для лучшей читаемости
- Добавлены цветные бейджи для ролей
- Улучшены стили кнопок удаления

### 4. ✅ Улучшен интерфейс выбора клиентов
**Добавлено**:
- Отображение email клиентов (если есть)
- Кнопки для всех ролей (арендодатель, арендатор, риелтор, свидетель)
- Улучшенные стили кнопок с hover-эффектами
- Добавлена рамка для карточек клиентов

## Файлы, которые были изменены:

1. **`src/app/api/upload/route.ts`** - Добавлена поддержка документов
2. **`src/app/api/upload/document/route.ts`** - Новый API для загрузки документов
3. **`src/components/signature/SignerSelector.tsx`** - Улучшен выбор подписантов
4. **`src/components/mosaic/DigitalSignature.tsx`** - Исправлено отображение
5. **`src/app/(protected)/signature/page.tsx`** - Обновлен для использования нового API

## Как использовать:

### Загрузка документа:
1. Перейдите на страницу "Электронная подпись"
2. Нажмите "Добавить документ для подписи"
3. Выберите тип документа
4. Загрузите файл (PDF, DOC, DOCX)
5. Выберите подписантов

### Добавление нового подписанта:
1. В модальном окне выбора подписантов нажмите "Добавить нового подписанта"
2. Заполните форму (имя, фамилия, телефон обязательны)
3. Выберите роль
4. Нажмите "Добавить"

### Выбор существующих подписантов:
1. Используйте поиск для быстрого нахождения клиентов
2. Нажмите на кнопку с нужной ролью рядом с клиентом
3. Подписант появится в списке выбранных

## Технические детали:

- Создана папка `public/uploads/documents/` для хранения документов
- Добавлена валидация файлов на клиенте и сервере
- Улучшена обработка ошибок
- Добавлены TypeScript типы для всех новых функций 